<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>porepy.numerics.fv.fvutils module &mdash; PorePy 1.6.0 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
    <link rel="canonical" href="https://pmgbergen.github.io/porepy/docsrc/porepy/porepy.numerics.fv.fvutils.html" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="porepy.numerics.fv.mass_matrix module" href="porepy.numerics.fv.mass_matrix.html" />
    <link rel="prev" title="porepy.numerics.fv.fv_elliptic module" href="porepy.numerics.fv.fv_elliptic.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #2980B9" >
            <a href="../../index.html" class="icon icon-home"> PorePy
          </a>
              <div class="version">
                1.6.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../howto/howto-docstring.html">1. How-To docstring</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="modules.html">porepy</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="porepy.html">porepy package</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="porepy.fracs.html">porepy.fracs package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="porepy.fracs.fracture.html">porepy.fracs.fracture module</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.fracs.fracture_importer.html">porepy.fracs.fracture_importer module</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.fracs.fracture_network_2d.html">porepy.fracs.fracture_network_2d module</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.fracs.fracture_network_3d.html">porepy.fracs.fracture_network_3d module</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.fracs.gmsh_interface.html">porepy.fracs.gmsh_interface module</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.fracs.line_fracture.html">porepy.fracs.line_fracture module</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.fracs.meshing.html">porepy.fracs.meshing module</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.fracs.msh_2_grid.html">porepy.fracs.msh_2_grid module</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.fracs.non_conforming.html">porepy.fracs.non_conforming module</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.fracs.plane_fracture.html">porepy.fracs.plane_fracture module</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.fracs.simplex.html">porepy.fracs.simplex module</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.fracs.split_grid.html">porepy.fracs.split_grid module</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.fracs.structured.html">porepy.fracs.structured module</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.fracs.tools.html">porepy.fracs.tools module</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.fracs.utils.html">porepy.fracs.utils module</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.fracs.wells_3d.html">porepy.fracs.wells_3d module</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="porepy.geometry.html">porepy.geometry package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="porepy.geometry.bounding_box.html">porepy.geometry.bounding_box module</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.geometry.constrain_geometry.html">porepy.geometry.constrain_geometry module</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.geometry.distances.html">porepy.geometry.distances module</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.geometry.geometry_property_checks.html">porepy.geometry.geometry_property_checks module</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.geometry.half_space.html">porepy.geometry.half_space module</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.geometry.intersections.html">porepy.geometry.intersections module</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.geometry.map_geometry.html">porepy.geometry.map_geometry module</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.geometry.point_in_polyhedron_test.html">porepy.geometry.point_in_polyhedron_test module</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="porepy.grids.html">porepy.grids package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="porepy.grids.standard_grids.html">porepy.grids.standard_grids package</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.grids.boundary_grid.html">porepy.grids.boundary_grid module</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.grids.coarsening.html">porepy.grids.coarsening module</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.grids.grid.html">porepy.grids.grid module</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.grids.grid_extrusion.html">porepy.grids.grid_extrusion module</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.grids.match_grids.html">porepy.grids.match_grids module</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.grids.md_grid.html">porepy.grids.md_grid module</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.grids.mortar_grid.html">porepy.grids.mortar_grid module</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.grids.partition.html">porepy.grids.partition module</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.grids.point_grid.html">porepy.grids.point_grid module</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.grids.refinement.html">porepy.grids.refinement module</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.grids.simplex.html">porepy.grids.simplex module</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.grids.structured.html">porepy.grids.structured module</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="porepy.models.html">porepy.models package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="porepy.models.verification_setups.html">porepy.models.verification_setups package</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.models.abstract_equations.html">porepy.models.abstract_equations module</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.models.abstract_model.html">porepy.models.abstract_model module</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.models.constitutive_laws.html">porepy.models.constitutive_laws module</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.models.contact_mechanics_biot_model.html">porepy.models.contact_mechanics_biot_model module</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.models.contact_mechanics_model.html">porepy.models.contact_mechanics_model module</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.models.energy_balance.html">porepy.models.energy_balance module</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.models.fluid_mass_balance.html">porepy.models.fluid_mass_balance module</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.models.geometry.html">porepy.models.geometry module</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.models.incompressible_flow_model.html">porepy.models.incompressible_flow_model module</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.models.mass_and_energy_balance.html">porepy.models.mass_and_energy_balance module</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.models.material_constants.html">porepy.models.material_constants module</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.models.momentum_balance.html">porepy.models.momentum_balance module</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.models.poromechanics.html">porepy.models.poromechanics module</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.models.run_models.html">porepy.models.run_models module</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.models.slightly_compressible_flow_model.html">porepy.models.slightly_compressible_flow_model module</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.models.solution_strategy.html">porepy.models.solution_strategy module</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.models.thermoporomechanics.html">porepy.models.thermoporomechanics module</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.models.thm_model.html">porepy.models.thm_model module</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.models.units.html">porepy.models.units module</a></li>
</ul>
</li>
<li class="toctree-l3 current"><a class="reference internal" href="porepy.numerics.html">porepy.numerics package</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="porepy.numerics.ad.html">porepy.numerics.ad package</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.numerics.fem.html">porepy.numerics.fem package</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.numerics.fracture_deformation.html">porepy.numerics.fracture_deformation package</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="porepy.numerics.fv.html">porepy.numerics.fv package</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.numerics.interface_laws.html">porepy.numerics.interface_laws package</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.numerics.linalg.html">porepy.numerics.linalg package</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.numerics.mixed_dim.html">porepy.numerics.mixed_dim package</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.numerics.nonlinear.html">porepy.numerics.nonlinear package</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.numerics.solvers.html">porepy.numerics.solvers package</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.numerics.vem.html">porepy.numerics.vem package</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.numerics.discretization.html">porepy.numerics.discretization module</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.numerics.displacement_correlation.html">porepy.numerics.displacement_correlation module</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.numerics.linear_solvers.html">porepy.numerics.linear_solvers module</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.numerics.time_step_control.html">porepy.numerics.time_step_control module</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="porepy.params.html">porepy.params package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="porepy.params.bc.html">porepy.params.bc module</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.params.data.html">porepy.params.data module</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.params.fluid.html">porepy.params.fluid module</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.params.parameter_dictionaries.html">porepy.params.parameter_dictionaries module</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.params.rock.html">porepy.params.rock module</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.params.tensor.html">porepy.params.tensor module</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="porepy.utils.html">porepy.utils package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="porepy.utils.derived_discretizations.html">porepy.utils.derived_discretizations package</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.utils.accumarray.html">porepy.utils.accumarray module</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.utils.adtree.html">porepy.utils.adtree module</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.utils.array_operations.html">porepy.utils.array_operations module</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.utils.common_constants.html">porepy.utils.common_constants module</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.utils.default_domains.html">porepy.utils.default_domains module</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.utils.error.html">porepy.utils.error module</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.utils.graph.html">porepy.utils.graph module</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.utils.grid_utils.html">porepy.utils.grid_utils module</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.utils.interpolation_tables.html">porepy.utils.interpolation_tables module</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.utils.mcolon.html">porepy.utils.mcolon module</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.utils.permutations.html">porepy.utils.permutations module</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.utils.porepy_types.html">porepy.utils.porepy_types module</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.utils.setmembership.html">porepy.utils.setmembership module</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.utils.sort_points.html">porepy.utils.sort_points module</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.utils.tags.html">porepy.utils.tags module</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.utils.tangential_normal_projection.html">porepy.utils.tangential_normal_projection module</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="porepy.viz.html">porepy.viz package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="porepy.viz.data_saving_model_mixin.html">porepy.viz.data_saving_model_mixin module</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.viz.exporter.html">porepy.viz.exporter module</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.viz.fracture_visualization.html">porepy.viz.fracture_visualization module</a></li>
<li class="toctree-l4"><a class="reference internal" href="porepy.viz.plot_grid.html">porepy.viz.plot_grid module</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #2980B9" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">PorePy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="modules.html">porepy</a></li>
          <li class="breadcrumb-item"><a href="porepy.html">porepy package</a></li>
          <li class="breadcrumb-item"><a href="porepy.numerics.html">porepy.numerics package</a></li>
          <li class="breadcrumb-item"><a href="porepy.numerics.fv.html">porepy.numerics.fv package</a></li>
      <li class="breadcrumb-item active">porepy.numerics.fv.fvutils module</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="module-porepy.numerics.fv.fvutils">
<span id="porepy-numerics-fv-fvutils-module"></span><h1>porepy.numerics.fv.fvutils module<a class="headerlink" href="#module-porepy.numerics.fv.fvutils" title="Permalink to this heading"></a></h1>
<p>Various FV specific utility functions.</p>
<p>Implementation note: This could perhaps have been implemneted as a superclass
for MPxA discertizations, however, due to the somewhat intricate inheritance relation
between these methods, the current structure with multiple auxiliary methods emerged.</p>
<dl class="py class">
<dt class="sig sig-object py" id="porepy.numerics.fv.fvutils.ExcludeBoundaries">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">ExcludeBoundaries</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">subcell_topology</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bound</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nd</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/porepy/numerics/fv/fvutils.html#ExcludeBoundaries"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#porepy.numerics.fv.fvutils.ExcludeBoundaries" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>Wrapper class to store mappings needed in the finite volume discretizations.
The original use for this class was for exclusion of equations that are
redundant due to the presence of boundary conditions, hence the name. The use of
this class has increased to also include linear transformation that can be applied
to the subfaces before the exclusion operator. This will typically be a rotation matrix,
so that the boundary conditions can be specified in an arbitary coordinate system.</p>
<p>The systems being set up in mpfa (and mpsa) describe continuity of flux and
potential (respectively stress and displacement) on all sub-faces. For the boundary
faces, unless a Robin condition is specified, only one of the two should be included
(e.g. for a Dirichlet boundary condition, there is no concept of continuity of
flux/stresses). This class contains mappings to eliminate the necessary fields in
order set the correct boundary conditions.</p>
<dl class="py method">
<dt class="sig sig-object py" id="porepy.numerics.fv.fvutils.ExcludeBoundaries.exclude_boundary">
<span class="sig-name descname"><span class="pre">exclude_boundary</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">transform</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/porepy/numerics/fv/fvutils.html#ExcludeBoundaries.exclude_boundary"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#porepy.numerics.fv.fvutils.ExcludeBoundaries.exclude_boundary" title="Permalink to this definition"></a></dt>
<dd><p>Mapping to exclude faces/component with any boundary condition from
local systems.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>other</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">scipy.sparse</span> <span class="pre">matrix</span></code>) – Matrix of local equations for
continuity of flux and pressure.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><dl class="simple">
<dt>scipy.sparse matrix, with rows corresponding to faces/components with</dt><dd><p>Neumann conditions eliminated.</p>
</dd>
</dl>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="porepy.numerics.fv.fvutils.ExcludeBoundaries.exclude_dirichlet">
<span class="sig-name descname"><span class="pre">exclude_dirichlet</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">transform</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/porepy/numerics/fv/fvutils.html#ExcludeBoundaries.exclude_dirichlet"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#porepy.numerics.fv.fvutils.ExcludeBoundaries.exclude_dirichlet" title="Permalink to this definition"></a></dt>
<dd><p>Mapping to exclude faces/components with Dirichlet boundary conditions from
local systems.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>other</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">scipy.sparse</span> <span class="pre">matrix</span></code>) – Matrix of local equations for
continuity of flux and pressure.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><dl class="simple">
<dt>scipy.sparse matrix, with rows corresponding to faces/components with</dt><dd><p>Dirichlet conditions eliminated.</p>
</dd>
</dl>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="porepy.numerics.fv.fvutils.ExcludeBoundaries.exclude_neumann">
<span class="sig-name descname"><span class="pre">exclude_neumann</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">transform</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/porepy/numerics/fv/fvutils.html#ExcludeBoundaries.exclude_neumann"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#porepy.numerics.fv.fvutils.ExcludeBoundaries.exclude_neumann" title="Permalink to this definition"></a></dt>
<dd><p>Mapping to exclude faces/components with Neumann boundary conditions from
local systems.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>other</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">scipy.sparse</span> <span class="pre">matrix</span></code>) – Matrix of local equations for
continuity of flux and pressure.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><dl class="simple">
<dt>scipy.sparse matrix, with rows corresponding to faces/components with</dt><dd><p>Neumann conditions eliminated.</p>
</dd>
</dl>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="porepy.numerics.fv.fvutils.ExcludeBoundaries.exclude_neumann_dirichlet">
<span class="sig-name descname"><span class="pre">exclude_neumann_dirichlet</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">transform</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/porepy/numerics/fv/fvutils.html#ExcludeBoundaries.exclude_neumann_dirichlet"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#porepy.numerics.fv.fvutils.ExcludeBoundaries.exclude_neumann_dirichlet" title="Permalink to this definition"></a></dt>
<dd><p>Mapping to exclude faces/components with Neumann and Dirichlet boundary
conditions from local systems.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>other</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">scipy.sparse</span> <span class="pre">matrix</span></code>) – Matrix of local equations for
continuity of flux and pressure.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><dl class="simple">
<dt>scipy.sparse matrix, with rows corresponding to faces/components with</dt><dd><p>Neumann conditions eliminated.</p>
</dd>
</dl>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="porepy.numerics.fv.fvutils.ExcludeBoundaries.exclude_neumann_robin">
<span class="sig-name descname"><span class="pre">exclude_neumann_robin</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">transform</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/porepy/numerics/fv/fvutils.html#ExcludeBoundaries.exclude_neumann_robin"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#porepy.numerics.fv.fvutils.ExcludeBoundaries.exclude_neumann_robin" title="Permalink to this definition"></a></dt>
<dd><p>Mapping to exclude faces/components with Neumann and Robin boundary
conditions from local systems.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>other</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">scipy.sparse</span> <span class="pre">matrix</span></code>) – Matrix of local equations for
continuity of flux and pressure.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><dl class="simple">
<dt>scipy.sparse matrix, with rows corresponding to faces/components with</dt><dd><p>Neumann conditions eliminated.</p>
</dd>
</dl>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="porepy.numerics.fv.fvutils.ExcludeBoundaries.exclude_robin_dirichlet">
<span class="sig-name descname"><span class="pre">exclude_robin_dirichlet</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">transform</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/porepy/numerics/fv/fvutils.html#ExcludeBoundaries.exclude_robin_dirichlet"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#porepy.numerics.fv.fvutils.ExcludeBoundaries.exclude_robin_dirichlet" title="Permalink to this definition"></a></dt>
<dd><p>Mapping to exclude faces/components with Robin and Dirichlet boundary
conditions from local systems.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>other</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">scipy.sparse</span> <span class="pre">matrix</span></code>) – Matrix of local equations for
continuity of flux and pressure.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><dl class="simple">
<dt>scipy.sparse matrix, with rows corresponding to faces/components with</dt><dd><p>Neumann conditions eliminated.</p>
</dd>
</dl>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="porepy.numerics.fv.fvutils.ExcludeBoundaries.keep_neumann">
<span class="sig-name descname"><span class="pre">keep_neumann</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">transform</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/porepy/numerics/fv/fvutils.html#ExcludeBoundaries.keep_neumann"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#porepy.numerics.fv.fvutils.ExcludeBoundaries.keep_neumann" title="Permalink to this definition"></a></dt>
<dd><p>Mapping to exclude faces/components that is not on the Neumann boundary
conditions from local systems.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>other</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">scipy.sparse</span> <span class="pre">matrix</span></code>) – Matrix of local equations for
continuity of flux and pressure.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><dl class="simple">
<dt>scipy.sparse matrix, with rows corresponding to faces/components with</dt><dd><p>all but Neumann conditions eliminated.</p>
</dd>
</dl>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="porepy.numerics.fv.fvutils.ExcludeBoundaries.keep_robin">
<span class="sig-name descname"><span class="pre">keep_robin</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">transform</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/porepy/numerics/fv/fvutils.html#ExcludeBoundaries.keep_robin"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#porepy.numerics.fv.fvutils.ExcludeBoundaries.keep_robin" title="Permalink to this definition"></a></dt>
<dd><p>Mapping to exclude faces/components that is not on the Robin boundary
conditions from local systems.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>other</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">scipy.sparse</span> <span class="pre">matrix</span></code>) – Matrix of local equations for
continuity of flux and pressure.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><dl class="simple">
<dt>scipy.sparse matrix, with rows corresponding to faces/components with</dt><dd><p>all but Robin conditions eliminated.</p>
</dd>
</dl>
</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="porepy.numerics.fv.fvutils.SubcellTopology">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">SubcellTopology</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sd</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/porepy/numerics/fv/fvutils.html#SubcellTopology"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#porepy.numerics.fv.fvutils.SubcellTopology" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>Class to represent data of subcell topology (interaction regions) for
mpsa/mpfa.</p>
<dl class="py attribute">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">g</span> <span class="pre">-</span> <span class="pre">the</span> <span class="pre">grid</span></span></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">Subcell</span> <span class="pre">topology,</span> <span class="pre">all</span> <span class="pre">cells</span> <span class="pre">seen</span> <span class="pre">apart</span></span></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">nno</span> <span class="pre">-</span> <span class="pre">node</span> <span class="pre">numbers</span></span></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">fno</span> <span class="pre">-</span> <span class="pre">face</span> <span class="pre">numbers</span></span></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">cno</span> <span class="pre">-</span> <span class="pre">cell</span> <span class="pre">numbers</span></span></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">subfno</span> <span class="pre">-</span> <span class="pre">subface</span> <span class="pre">numbers.</span> <span class="pre">Has</span> <span class="pre">exactly</span> <span class="pre">two</span> <span class="pre">duplicates</span> <span class="pre">for</span> <span class="pre">internal</span> <span class="pre">faces</span></span></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">subhfno</span> <span class="pre">-</span> <span class="pre">subface</span> <span class="pre">numbers.</span> <span class="pre">No</span> <span class="pre">duplicates</span></span></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">num_cno</span> <span class="pre">-</span> <span class="pre">cno.max()</span> <span class="pre">+</span> <span class="pre">1</span></span></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">num_subfno</span> <span class="pre">-</span> <span class="pre">subfno.max()</span> <span class="pre">+</span> <span class="pre">1</span></span></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">Subcell</span> <span class="pre">topology,</span> <span class="pre">after</span> <span class="pre">cells</span> <span class="pre">sharing</span> <span class="pre">a</span> <span class="pre">face</span> <span class="pre">have</span> <span class="pre">been</span> <span class="pre">joined.</span> <span class="pre">Use</span></span></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">terminology</span> <span class="pre">_unique,</span> <span class="pre">since</span> <span class="pre">subfno</span> <span class="pre">is</span> <span class="pre">unique</span> <span class="pre">after</span></span></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">nno_unique</span> <span class="pre">-</span> <span class="pre">node</span> <span class="pre">numbers</span> <span class="pre">after</span> <span class="pre">pairing</span> <span class="pre">sub-faces</span></span></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">fno_unique</span> <span class="pre">-</span> <span class="pre">face</span> <span class="pre">numbers</span> <span class="pre">after</span> <span class="pre">pairing</span> <span class="pre">sub-faces</span></span></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">cno_unique</span> <span class="pre">-</span> <span class="pre">cell</span> <span class="pre">numbers</span> <span class="pre">after</span> <span class="pre">pairing</span> <span class="pre">sub-faces</span></span></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">subfno_unique</span> <span class="pre">-</span> <span class="pre">subface</span> <span class="pre">numbers</span>&#160; <span class="pre">after</span> <span class="pre">pairing</span> <span class="pre">sub-faces</span></span></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">unique_subfno</span> <span class="pre">-</span> <span class="pre">index</span> <span class="pre">of</span> <span class="pre">those</span> <span class="pre">elements</span> <span class="pre">in</span> <span class="pre">subfno</span> <span class="pre">that</span> <span class="pre">are</span> <span class="pre">included</span></span></dt>
<dd><p>in subfno_unique, that is subfno_unique = subfno[unique_subfno],
and similarly cno_unique = cno[subfno_unique] etc.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">num_subfno_unique</span> <span class="pre">=</span> <span class="pre">subfno_unique.max()</span> <span class="pre">+</span> <span class="pre">1</span></span></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="porepy.numerics.fv.fvutils.SubcellTopology.pair_over_subfaces">
<span class="sig-name descname"><span class="pre">pair_over_subfaces</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/porepy/numerics/fv/fvutils.html#SubcellTopology.pair_over_subfaces"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#porepy.numerics.fv.fvutils.SubcellTopology.pair_over_subfaces" title="Permalink to this definition"></a></dt>
<dd><p>Transfer quantities from a cell-face base (cells sharing a face have
their own expressions) to a face-based. The quantities should live
on sub-faces (not faces)</p>
<p>The normal vector is honored, so that the here and there side get
different signs when paired up.</p>
<p>The method is intended used for combining forces, fluxes,
displacements and pressures, as used in MPSA / MPFA.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>other</strong> – sps.matrix, size (self.subhfno.size x something)</p>
</dd>
</dl>
<dl class="simple">
<dt>Returns</dt><dd><p>sps.matrix, size (self.subfno_unique.size x something)</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="porepy.numerics.fv.fvutils.SubcellTopology.pair_over_subfaces_nd">
<span class="sig-name descname"><span class="pre">pair_over_subfaces_nd</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/porepy/numerics/fv/fvutils.html#SubcellTopology.pair_over_subfaces_nd"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#porepy.numerics.fv.fvutils.SubcellTopology.pair_over_subfaces_nd" title="Permalink to this definition"></a></dt>
<dd><p>nd-version of pair_over_subfaces, see above.</p>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="porepy.numerics.fv.fvutils.append_dofs_of_discretization">
<span class="sig-name descname"><span class="pre">append_dofs_of_discretization</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sd</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">d</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kw1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kw2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">k_dof</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/porepy/numerics/fv/fvutils.html#append_dofs_of_discretization"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#porepy.numerics.fv.fvutils.append_dofs_of_discretization" title="Permalink to this definition"></a></dt>
<dd><p>Appends rows to existing discretizations stored as ‘stress’ and
‘bound_stress’ in the data dictionary on the nodes. Only applies to the
highest dimension (for now, at least). The newly added faces are found
from ‘new_faces’ in the data dictionary.
Assumes all new rows and columns should be appended, not inserted to
the “interior” of the discretization matrices.
sd -     grid object
d -     corresponding data dictionary
kw1 -   keyword for the stored discretization in the data dictionary,</p>
<blockquote>
<div><p>e.g. ‘flux’</p>
</div></blockquote>
<dl class="simple">
<dt>kw2 -   keyword for the stored boundary discretization in the data</dt><dd><p>dictionary, e.g. ‘bound_flux’</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="porepy.numerics.fv.fvutils.boundary_to_sub_boundary">
<span class="sig-name descname"><span class="pre">boundary_to_sub_boundary</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">bound</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">subcell_topology</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/porepy/numerics/fv/fvutils.html#boundary_to_sub_boundary"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#porepy.numerics.fv.fvutils.boundary_to_sub_boundary" title="Permalink to this definition"></a></dt>
<dd><p>Convert a boundary condition defined for faces to a boundary condition defined by
subfaces.</p>
<p>Args:
bound (pp.BoundaryCondition/pp.BoundarConditionVectorial):</p>
<blockquote>
<div><p>Boundary condition given for faces.</p>
</div></blockquote>
<dl class="simple">
<dt>subcell_topology (pp.fvutils.SubcellTopology):</dt><dd><p>The subcell topology defining the finite volume subgrid.</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><dl class="simple">
<dt>An instance of the</dt><dd><p>BoundaryCondition/BoundaryConditionVectorial class, where all face values of
bound has been copied to the subfaces as defined by subcell_topology.</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>pp.BoundarCondition/pp.BoundarConditionVectorial</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="porepy.numerics.fv.fvutils.cell_ind_for_partial_update">
<span class="sig-name descname"><span class="pre">cell_ind_for_partial_update</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sd</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cells</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">faces</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nodes</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/porepy/numerics/fv/fvutils.html#cell_ind_for_partial_update"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#porepy.numerics.fv.fvutils.cell_ind_for_partial_update" title="Permalink to this definition"></a></dt>
<dd><p>Obtain indices of cells and faces needed for a partial update of the
discretization stencil.</p>
<p>Implementation note: This function should really be split into three parts,
one for each of the modes (cell, face, node).</p>
<p>The subgrid can be specified in terms of cells, faces and nodes to be
updated. The method will then define a sufficiently large subgrid to
account for changes in the flux discretization. The idea is that cells are
used to account for updates in material parameters (or geometry), faces
when faces are split (fracture growth), while the parameter nodes is mainly
aimed at a gradual build of the discretization of the entire grid (for
memory conservation, see comments in mpfa.mpfa()). For more details, see
the implementations and comments below.</p>
<p>Cautionary note: The option to combine cells, faces and nodes in one go has
not been tested. Problems may arise for grid configurations where separate
regions are close to touching. This is however speculation at the time of
writing.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>g</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">core.grids.grid</span></code>) – grid to be discretized</p></li>
<li><p><strong>cells</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">np.array,</span> <span class="pre">int,</span> <span class="pre">optional</span></code>) – Index of cells on which to base the
subgrid computation. Defaults to None.</p></li>
<li><p><strong>faces</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">np.array,</span> <span class="pre">int,</span> <span class="pre">optional</span></code>) – Index of faces on which to base the
subgrid computation. Defaults to None.</p></li>
<li><p><strong>nodes</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">np.array,</span> <span class="pre">int,</span> <span class="pre">optional</span></code>) – Index of faces on which to base the
subgrid computation. Defaults to None.</p></li>
<li><p><strong>sd</strong> (<a class="reference internal" href="porepy.grids.grid.html#porepy.grids.grid.Grid" title="porepy.grids.grid.Grid"><em>Grid</em></a>) – </p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><dl class="simple">
<dt>Cell indexes of the subgrid. No guarantee that they form</dt><dd><p>a connected grid.</p>
</dd>
</dl>
<p>np.array, int: Indexes of faces to have their discretization updated.</p>
</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>np.array, <a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.11)">int</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="porepy.numerics.fv.fvutils.cell_scalar_to_subcell_vector">
<span class="sig-name descname"><span class="pre">cell_scalar_to_subcell_vector</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nd</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sub_cell_index</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cell_index</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/porepy/numerics/fv/fvutils.html#cell_scalar_to_subcell_vector"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#porepy.numerics.fv.fvutils.cell_scalar_to_subcell_vector" title="Permalink to this definition"></a></dt>
<dd><p>Create mapping from sub-cells to cells for vector problems.
For example, discretization of grad_p-term in Biot,
where p is a cell-center scalar</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>nd</strong> – dimension</p></li>
<li><p><strong>sub_cell_index</strong> – sub-cell indices</p></li>
<li><p><strong>cell_index</strong> – cell indices</p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.sparse.csr_matrix.html#scipy.sparse.csr_matrix" title="(in SciPy v1.10.0)">scipy.sparse.csr_matrix</a> (shape num_subcells * nd, num_cells)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="porepy.numerics.fv.fvutils.cell_vector_to_subcell">
<span class="sig-name descname"><span class="pre">cell_vector_to_subcell</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nd</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sub_cell_index</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cell_index</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/porepy/numerics/fv/fvutils.html#cell_vector_to_subcell"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#porepy.numerics.fv.fvutils.cell_vector_to_subcell" title="Permalink to this definition"></a></dt>
<dd><p>Create mapping from sub-cells to cells for scalar problems.
For example, discretization of div_g-term in mpfa with gravity,
where g is a cell-center vector (dim nd)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>nd</strong> – dimension</p></li>
<li><p><strong>sub_cell_index</strong> – sub-cell indices</p></li>
<li><p><strong>cell_index</strong> – cell indices</p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.sparse.csr_matrix.html#scipy.sparse.csr_matrix" title="(in SciPy v1.10.0)">scipy.sparse.csr_matrix</a> (shape num_subcells * nd, num_cells * nd)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="porepy.numerics.fv.fvutils.compute_darcy_flux">
<span class="sig-name descname"><span class="pre">compute_darcy_flux</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mdg</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">keyword</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'flow'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">keyword_store</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">d_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'darcy_flux'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">p_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'pressure'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lam_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'mortar_solution'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">well_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'well_flux'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">from_iterate</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/porepy/numerics/fv/fvutils.html#compute_darcy_flux"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#porepy.numerics.fv.fvutils.compute_darcy_flux" title="Permalink to this definition"></a></dt>
<dd><p>Computes darcy_flux over all faces in the entire mixed-dimensional grid given
pressures for all nodes, provided as node properties.</p>
<p>Parameter:
mgd: mixed-dimensional grid with the following data fields for all nodes/grids:</p>
<blockquote>
<div><p>‘flux’: Internal discretization of fluxes.
‘bound_flux’: Discretization of boundary fluxes.
‘pressure’: Pressure values for each cell of the grid (overwritten by p_name).
‘bc_val’: Boundary condition values.</p>
<blockquote>
<div><p>and the following edge property field for all connected grids:</p>
</div></blockquote>
<p>‘coupling_flux’: Discretization of the coupling fluxes.</p>
</div></blockquote>
<dl class="simple">
<dt>keyword (str): defaults to ‘flow’. The parameter keyword used to obtain the</dt><dd><p>data necessary to compute the fluxes.</p>
</dd>
<dt>keyword_store (str): defaults to keyword. The parameter keyword determining</dt><dd><p>where the data will be stored.</p>
</dd>
<dt>d_name (str): defaults to ‘darcy_flux’. The parameter name which the computed</dt><dd><p>darcy_flux will be stored by in the dictionary.</p>
</dd>
<dt>p_name (str): defaults to ‘pressure’. The keyword that the pressure</dt><dd><p>field is stored by in the dictionary.</p>
</dd>
<dt>lam_name (str): defaults to ‘mortar_solution’. The keyword that the mortar flux</dt><dd><p>field is stored by in the dictionary.</p>
</dd>
<dt>data (dictionary): defaults to None. If mdg is mono-dimensional grid the data</dt><dd><p>dictionary must be given. If mdg is a multi-dimensional grid, this variable has
no effect.</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>the same mixed-dimensional grid with the added
field ‘darcy_flux’ added to all subdomain data fields. Note that the
fluxes between grids will be added only at the mdg edge, not at the node
fields. The signs of the darcy_flux correspond to the directions of the
normals, in the edge/coupling case those of the higher grid. For edges
between grids of equal dimension, there is an implicit assumption
that all normals point from the second to the first of the sorted grids
(mdg.sorted_nodes_of_edge(e)).</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>pp.MixedDimensionalGrid</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="porepy.numerics.fv.fvutils.compute_dist_face_cell">
<span class="sig-name descname"><span class="pre">compute_dist_face_cell</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sd</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">subcell_topology</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">eta</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_paired</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/porepy/numerics/fv/fvutils.html#compute_dist_face_cell"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#porepy.numerics.fv.fvutils.compute_dist_face_cell" title="Permalink to this definition"></a></dt>
<dd><p>Compute vectors from cell centers continuity points on each sub-face.</p>
<p>The location of the continuity point is given by</p>
<blockquote>
<div><p>x_cp = (1-eta) * x_facecenter + eta * x_vertex</p>
</div></blockquote>
<p>On the boundary, eta is set to zero, thus the continuity point is at the
face center</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>sd</strong> – Grid</p></li>
<li><p><strong>subcell_topology</strong> – Of class subcell topology in this module</p></li>
<li><p><strong>eta</strong> – [0,1), eta = 0 gives cont. pt. at face midpoint, eta = 1 means at
the vertex. If eta is given as a scalar this value will be applied to
all subfaces except the boundary faces, where eta=0 will be enforced.
If the length of eta equals the number of subfaces, eta[i] will be used
in the computation of the continuity point of the subface s_t.subfno_unique[i].
Note that eta=0 at the boundary is ONLY enforced for scalar eta.</p></li>
</ul>
</dd>
</dl>
<dl class="simple">
<dt>Returns</dt><dd><p>sps.csr() matrix representation of vectors. Size sd.nf x (sd.nc * sd.nd)</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><p><strong>ValueError if the size</strong><strong> of </strong><strong>eta is not 1</strong><strong> or </strong><strong>subcell_topology.num_subfno_unique.</strong> – </p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="porepy.numerics.fv.fvutils.determine_eta">
<span class="sig-name descname"><span class="pre">determine_eta</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sd</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/porepy/numerics/fv/fvutils.html#determine_eta"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#porepy.numerics.fv.fvutils.determine_eta" title="Permalink to this definition"></a></dt>
<dd><p>Set default value for the location of continuity point eta in MPFA and
MSPA.</p>
<p>The function is intended to give a best estimate of eta in cases where the
user has not specified a value.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>sd</strong> (<a class="reference internal" href="porepy.grids.grid.html#porepy.grids.grid.Grid" title="porepy.grids.grid.Grid"><em>Grid</em></a>) – Grid for discretization</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><dl class="simple">
<dt>double. 1/3 if the grid in known to consist of simplicies (it is one of</dt><dd><p>TriangleGrid, TetrahedralGrid, or their structured versions). 0 if
not.</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.11)">float</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="porepy.numerics.fv.fvutils.expand_indices_incr">
<span class="sig-name descname"><span class="pre">expand_indices_incr</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ind</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dim</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">increment</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/porepy/numerics/fv/fvutils.html#expand_indices_incr"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#porepy.numerics.fv.fvutils.expand_indices_incr" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="porepy.numerics.fv.fvutils.expand_indices_nd">
<span class="sig-name descname"><span class="pre">expand_indices_nd</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ind</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nd</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">direction</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'F'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/porepy/numerics/fv/fvutils.html#expand_indices_nd"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#porepy.numerics.fv.fvutils.expand_indices_nd" title="Permalink to this definition"></a></dt>
<dd><p>Expand indices from scalar to vector form.</p>
<p>Examples:
&gt;&gt;&gt; i = np.array([0, 1, 3])
&gt;&gt;&gt; expand_indices_nd(i, 2)
(array([0, 1, 2, 3, 6, 7]))</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">expand_indices_nd</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">)</span>
<span class="go">(array([0, 3, 9, 1, 4, 10, 2, 5, 11])</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ind</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.24)"><em>ndarray</em></a>) – </p></li>
<li><p><strong>nd</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.11)"><em>int</em></a>) – </p></li>
<li><p><strong>direction</strong> – </p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.24)"><em>ndarray</em></a></p>
</dd>
</dl>
<p>Returns</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="porepy.numerics.fv.fvutils.find_active_indices">
<span class="sig-name descname"><span class="pre">find_active_indices</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">parameter_dictionary</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sd</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/porepy/numerics/fv/fvutils.html#find_active_indices"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#porepy.numerics.fv.fvutils.find_active_indices" title="Permalink to this definition"></a></dt>
<dd><p>Process information in parameter dictionary on whether the discretization
should consider a subgrid. Look for fields in the parameter dictionary called
specified_cells, specified_faces or specified_nodes. These are then processed by
the function pp.fvutils.cell-ind_for_partial_update.</p>
<p>If no relevant information is found, the active indices are all cells and
faces in the grid.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>parameter_dictionary</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a>) – Parameters, potentially containing fields
“specified_cells”, “specified_faces”, “specified_nodes”.</p></li>
<li><p><strong>sd</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">pp.Grid</span></code>) – Grid to be discretized.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><p>Cells to be included in the active grid.
np.ndarary: Faces to have their discretization updated. NOTE: This may not</p>
<blockquote>
<div><p>be all faces in the grid.</p>
</div></blockquote>
</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>np.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="porepy.numerics.fv.fvutils.map_hf_2_f">
<span class="sig-name descname"><span class="pre">map_hf_2_f</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fno</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">subfno</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nd</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sd</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/porepy/numerics/fv/fvutils.html#map_hf_2_f"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#porepy.numerics.fv.fvutils.map_hf_2_f" title="Permalink to this definition"></a></dt>
<dd><p>Create mapping from half-faces to faces for vector problems.
Either fno, subfno and nd should be given or g (and optinally nd) should be
given.</p>
<p>Args:
EITHER:</p>
<blockquote>
<div><p>fno (np.ndarray): face numbering in sub-cell topology based on unique subfno
subfno (np.ndarrary): sub-face numbering
nd (int): dimension</p>
</div></blockquote>
<dl>
<dt>OR:</dt><dd><dl class="simple">
<dt>g (pp.Grid): If a grid is supplied the function will set:</dt><dd><p>fno = pp.fvutils.SubcellTopology(g).fno_unique
subfno = pp.fvutils.SubcellTopology(g).subfno_unique</p>
</dd>
</dl>
<p>nd (int): Optinal, defaults to sd.dim. Defines the dimension of the vector.</p>
</dd>
</dl>
<p>Returns</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="porepy.numerics.fv.fvutils.map_subgrid_to_grid">
<span class="sig-name descname"><span class="pre">map_subgrid_to_grid</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sd</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">loc_faces</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">loc_cells</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">is_vector</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nd</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/porepy/numerics/fv/fvutils.html#map_subgrid_to_grid"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#porepy.numerics.fv.fvutils.map_subgrid_to_grid" title="Permalink to this definition"></a></dt>
<dd><p>Obtain mappings from the cells and faces of a subgrid back to a larger grid.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>g</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">pp.Grid</span></code>) – The larger grid.</p></li>
<li><p><strong>loc_faces</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">np.ndarray</span></code>) – For each face in the subgrid, the index of the
corresponding face in the larger grid.</p></li>
<li><p><strong>loc_cells</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">np.ndarray</span></code>) – For each cell in the subgrid, the index of the
corresponding cell in the larger grid.</p></li>
<li><p><strong>is_vector</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></a>) – If True, the returned mappings are sized to fit with vector
variables, with nd elements per cell and face.</p></li>
<li><p><strong>nd</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int,</span> <span class="pre">optional</span></code>) – Dimension. Defaults to sd.dim.</p></li>
<li><p><strong>sd</strong> (<a class="reference internal" href="porepy.grids.grid.html#porepy.grids.grid.Grid" title="porepy.grids.grid.Grid"><em>Grid</em></a>) – </p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.11)">tuple</a>[<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.24)">numpy.ndarray</a>, <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.24)">numpy.ndarray</a>]</p>
</dd>
</dl>
<dl class="simple">
<dt>Retuns:</dt><dd><dl class="simple">
<dt>sps.csr_matrix, size (sd.num_faces, loc_faces.size): Mapping from local to</dt><dd><p>global faces. If is_vector is True, the size is multiplied with sd.dim.</p>
</dd>
<dt>sps.csr_matrix, size (loc_cells.size, sd.num_cells): Mapping from global to</dt><dd><p>local cells. If is_vector is True, the size is multiplied with sd.dim.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="porepy.numerics.fv.fvutils.partial_discretization">
<span class="sig-name descname"><span class="pre">partial_discretization</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sd</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tensor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bnd</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">apertures</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">partial_discr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">physics</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'flow'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/porepy/numerics/fv/fvutils.html#partial_discretization"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#porepy.numerics.fv.fvutils.partial_discretization" title="Permalink to this definition"></a></dt>
<dd><p>Perform a partial (local) multi-point discretization on a grid with
provided data, tensor and boundary conditions by</p>
<blockquote>
<div><p>1)  Appending the existing discretization matrices to the right size
according to the added cells and faces.
2)  Discretizing on the relevant subgrids by calls to the provided
partial discretization function (mpfa_partial or mpsa_partial).
3)  Zeroing out the rows corresponding to the updated faces.
4)  Inserting the newly computed values to the just deleted rows.</p>
</div></blockquote>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="porepy.numerics.fv.fvutils.partial_update_discretization">
<span class="sig-name descname"><span class="pre">partial_update_discretization</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sd</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">keyword</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">discretize</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dim</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scalar_cell_right</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vector_cell_right</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scalar_face_right</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vector_face_right</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scalar_cell_left</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vector_cell_left</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scalar_face_left</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vector_face_left</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">second_keyword</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/porepy/numerics/fv/fvutils.html#partial_update_discretization"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#porepy.numerics.fv.fvutils.partial_update_discretization" title="Permalink to this definition"></a></dt>
<dd><p>Do partial update of discretization scheme.</p>
<p>This is intended as a helper function for the update_discretization methods of
fv schemes. In particular, this method allows for a unified implementation of
update in mpfa, mpsa and biot.</p>
<p>The implementation is somewhat heavy to cover both mpfa, mpsa and biot.</p>
<p>Parameters scalar_cell_right, vector_face_left etc. are lists of keys in the
discretization matrix dictionary. They are used to tell whehter the matrix should
be considered a cell or face quantity, and scalar of vector. Left and right are
used to map rows and columns, respectively.
Together these fields allows for mapping a discretization between grids.</p>
<p>If a term misses a right or left mapping, it will be ignored.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>sd</strong> (<a class="reference internal" href="porepy.grids.grid.html#porepy.grids.grid.Grid" title="porepy.grids.grid.Grid"><em>Grid</em></a>) – </p></li>
<li><p><strong>data</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.11)"><em>dict</em></a>) – </p></li>
<li><p><strong>keyword</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)"><em>str</em></a>) – </p></li>
<li><p><strong>discretize</strong> (<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Callable" title="(in Python v3.11)"><em>Callable</em></a>) – </p></li>
<li><p><strong>dim</strong> (<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.11)"><em>Optional</em></a><em>[</em><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.11)"><em>int</em></a><em>]</em>) – </p></li>
<li><p><strong>scalar_cell_right</strong> (<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.11)"><em>Optional</em></a><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.11)"><em>list</em></a><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)"><em>str</em></a><em>]</em><em>]</em>) – </p></li>
<li><p><strong>vector_cell_right</strong> (<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.11)"><em>Optional</em></a><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.11)"><em>list</em></a><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)"><em>str</em></a><em>]</em><em>]</em>) – </p></li>
<li><p><strong>scalar_face_right</strong> (<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.11)"><em>Optional</em></a><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.11)"><em>list</em></a><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)"><em>str</em></a><em>]</em><em>]</em>) – </p></li>
<li><p><strong>vector_face_right</strong> (<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.11)"><em>Optional</em></a><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.11)"><em>list</em></a><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)"><em>str</em></a><em>]</em><em>]</em>) – </p></li>
<li><p><strong>scalar_cell_left</strong> (<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.11)"><em>Optional</em></a><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.11)"><em>list</em></a><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)"><em>str</em></a><em>]</em><em>]</em>) – </p></li>
<li><p><strong>vector_cell_left</strong> (<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.11)"><em>Optional</em></a><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.11)"><em>list</em></a><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)"><em>str</em></a><em>]</em><em>]</em>) – </p></li>
<li><p><strong>scalar_face_left</strong> (<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.11)"><em>Optional</em></a><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.11)"><em>list</em></a><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)"><em>str</em></a><em>]</em><em>]</em>) – </p></li>
<li><p><strong>vector_face_left</strong> (<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.11)"><em>Optional</em></a><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.11)"><em>list</em></a><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)"><em>str</em></a><em>]</em><em>]</em>) – </p></li>
<li><p><strong>second_keyword</strong> (<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.11)"><em>Optional</em></a><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)"><em>str</em></a><em>]</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="porepy.numerics.fv.fvutils.remove_nonlocal_contribution">
<span class="sig-name descname"><span class="pre">remove_nonlocal_contribution</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">raw_ind</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nd</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/porepy/numerics/fv/fvutils.html#remove_nonlocal_contribution"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#porepy.numerics.fv.fvutils.remove_nonlocal_contribution" title="Permalink to this definition"></a></dt>
<dd><p>For a set of matrices, zero out rows associated with given faces, adjusting for
the matrices being related to vector quantities if necessary.</p>
<dl class="simple">
<dt>Example: If raw_ind = np.array([2]), and nd = 2, rows 4 and 5 will be eliminated</dt><dd><dl class="simple">
<dt>(row 0 and 1 will in this case be associated with face 0, row 2 and 3 with face</dt><dd><p>1).</p>
</dd>
</dl>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>raw_ind</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">np.ndarray</span></code>) – Face indices to have their rows eliminated.</p></li>
<li><p><strong>nd</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>) – Spatial dimension. Needed to map face indices to rows.</p></li>
<li><p><strong>*args</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">sps.spmatrix</span></code>) – Set of matrices. Will be eliminated in place.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>DESCRIPTION.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="porepy.numerics.fv.fvutils.scalar_divergence">
<span class="sig-name descname"><span class="pre">scalar_divergence</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sd</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/porepy/numerics/fv/fvutils.html#scalar_divergence"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#porepy.numerics.fv.fvutils.scalar_divergence" title="Permalink to this definition"></a></dt>
<dd><p>Get divergence operator for a grid.</p>
<p>The operator is easily accessible from the grid itself, so we keep it
here for completeness.</p>
<p>See also vector_divergence(g)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>sd</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">pp.Grid</span></code>) – grid</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.sparse.csr_matrix.html#scipy.sparse.csr_matrix" title="(in SciPy v1.10.0)"><em>csr_matrix</em></a></p>
</dd>
</dl>
<dl class="simple">
<dt>Returns</dt><dd><p>divergence operator</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="porepy.numerics.fv.fvutils.scalar_tensor_vector_prod">
<span class="sig-name descname"><span class="pre">scalar_tensor_vector_prod</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sd</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">k</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">subcell_topology</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/porepy/numerics/fv/fvutils.html#scalar_tensor_vector_prod"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#porepy.numerics.fv.fvutils.scalar_tensor_vector_prod" title="Permalink to this definition"></a></dt>
<dd><p>Compute product of normal vectors and tensors on a sub-cell level.
This is essentially defining Darcy’s law for each sub-face in terms of
sub-cell gradients. Thus, we also implicitly define the global ordering
of sub-cell gradient variables (via the interpretation of the columns in
nk).
NOTE: In the local numbering below, in particular in the variables i and j,
it is tacitly assumed that sd.dim == sd.nodes.shape[0] ==
sd.face_normals.shape[0] etc. See implementation note in main method.
:param sd: Discretization grid
:type sd: <code class="xref py py-class docutils literal notranslate"><span class="pre">pp.Grid</span></code>
:param k: The permeability tensor
:type k: <code class="xref py py-class docutils literal notranslate"><span class="pre">pp.Second_order_tensor</span></code>
:param subcell_topology: Wrapper class containing</p>
<blockquote>
<div><p>subcell numbering.</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><p>sub-face wise product of normal vector and permeability tensor.
cell_node_blocks pairings of node and cell indices, which together</p>
<blockquote>
<div><p>define a sub-cell.</p>
</div></blockquote>
<p>sub_cell_ind: index of all subcells</p>
</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>nk</p>
</dd>
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>sd</strong> (<a class="reference internal" href="porepy.grids.grid.html#porepy.grids.grid.Grid" title="porepy.grids.grid.Grid"><em>Grid</em></a>) – </p></li>
<li><p><strong>k</strong> (<a class="reference internal" href="porepy.params.tensor.html#porepy.params.tensor.SecondOrderTensor" title="porepy.params.tensor.SecondOrderTensor"><em>SecondOrderTensor</em></a>) – </p></li>
<li><p><strong>subcell_topology</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">fvutils.SubcellTopology</span></code>) – </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="porepy.numerics.fv.fvutils.subproblems">
<span class="sig-name descname"><span class="pre">subproblems</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sd</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_memory</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">peak_memory_estimate</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/porepy/numerics/fv/fvutils.html#subproblems"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#porepy.numerics.fv.fvutils.subproblems" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>sd</strong> (<a class="reference internal" href="porepy.grids.grid.html#porepy.grids.grid.Grid" title="porepy.grids.grid.Grid"><em>Grid</em></a>) – </p></li>
<li><p><strong>max_memory</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.11)"><em>int</em></a>) – </p></li>
<li><p><strong>peak_memory_estimate</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.11)"><em>int</em></a>) – </p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Generator" title="(in Python v3.11)"><em>Generator</em></a>[<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.11)">tuple</a>[<a class="reference internal" href="porepy.grids.grid.html#porepy.grids.grid.Grid" title="porepy.grids.grid.Grid">porepy.grids.grid.Grid</a>, <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.24)">numpy.ndarray</a>, <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.24)">numpy.ndarray</a>, <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.24)">numpy.ndarray</a>, <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.24)">numpy.ndarray</a>], None, None]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="porepy.numerics.fv.fvutils.vector_divergence">
<span class="sig-name descname"><span class="pre">vector_divergence</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sd</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/porepy/numerics/fv/fvutils.html#vector_divergence"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#porepy.numerics.fv.fvutils.vector_divergence" title="Permalink to this definition"></a></dt>
<dd><p>Get vector divergence operator for a grid g</p>
<p>It is assumed that the first column corresponds to the x-equation of face
0, second column is y-equation etc. (and so on in nd&gt;2). The next column is
then the x-equation for face 1. Correspondingly, the first row
represents x-component in first cell etc.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>sd</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">pp.Grid</span></code>) – grid</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.sparse.csr_matrix.html#scipy.sparse.csr_matrix" title="(in SciPy v1.10.0)"><em>csr_matrix</em></a></p>
</dd>
</dl>
<dl class="simple">
<dt>Returns</dt><dd><p>vector_div (sparse csr matrix), dimensions: nd * (num_cells, num_faces)</p>
</dd>
</dl>
</dd></dl>

</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="porepy.numerics.fv.fv_elliptic.html" class="btn btn-neutral float-left" title="porepy.numerics.fv.fv_elliptic module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="porepy.numerics.fv.mass_matrix.html" class="btn btn-neutral float-right" title="porepy.numerics.fv.mass_matrix module" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022 UiB Center for Modeling of Coupled Subsurface Dynamics, GNU LESSER GENERAL PUBLIC LICENSE Version 3, 29 June 2007..</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>